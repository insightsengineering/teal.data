<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>teal_data reproducibility â€¢ teal.data</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="teal_data reproducibility">
<link rel="stylesheet" href="../consent.css">
<script src="../consent.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">teal.data</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.0</small>

    <div style="width: 140px; margin-left: 0.5rem;"> <small class="nav-text text-muted me-auto">part of</small> <img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/nest.png?raw=true" alt="NEST" style="height: 30px;"><a href="https://pharmaverse.org/" class="external-link"><img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/pharmaverse.png?raw=true" alt="pharmaverse" style="height: 28px;"></a> </div>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/teal-data.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Get started</h6></li>
    <li><a class="dropdown-item" href="../articles/teal-data.html">Introduction to teal.data</a></li>
    <li><a class="dropdown-item" href="../articles/teal-data-reproducibility.html">teal_data reproducibility</a></li>
    <li><a class="dropdown-item" href="../articles/join-keys.html">Join Keys</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reports" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reports</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reports">
<li><a class="dropdown-item" href="../coverage-report/">Coverage report</a></li>
    <li><a class="dropdown-item" href="../unit-test-report/">Unit test report</a></li>
    <li><a class="dropdown-item" href="../unit-test-report-non-cran/">Non-CRAN unit test report</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/insightsengineering/teal.data"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>teal_data reproducibility</h1>
                        <h4 data-toc-skip class="author">NEST
CoreDev</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/insightsengineering/teal.data/blob/main/vignettes/teal-data-reproducibility.Rmd" class="external-link"><code>vignettes/teal-data-reproducibility.Rmd</code></a></small>
      <div class="d-none name"><code>teal-data-reproducibility.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="reproducibility-of-teal_data-objects">Reproducibility of <code>teal_data</code> objects<a class="anchor" aria-label="anchor" href="#reproducibility-of-teal_data-objects"></a>
</h2>
<p>Reproducibility is a primary function of the <code>qenv</code> class,
which <code>teal_data</code> inherits from. Every data modification in a
<code>teal_data</code> object is performed in an encapsulated
environment, separate from the global environment.</p>
<p>It is important to note that the reproducibility of this object is
limited only to the data-code relationship. Other aspects such as the
reliability of the data source, reproducibility of the R session
(including package versions), and creation and use of objects from other
environments (e.g.Â <code>.GlobalEnv</code>) cannot be verified properly
by <code>teal_data</code>. It is advisable to always begin analysis in a
new session and run all code that pertains to the analysis within the
<code>teal_data</code> object.</p>
<div class="section level3">
<h3 id="verification">Verification<a class="anchor" aria-label="anchor" href="#verification"></a>
</h3>
<div class="section level4">
<h4 id="verification-status">Verification status<a class="anchor" aria-label="anchor" href="#verification-status"></a>
</h4>
<p>Every <code>teal_data</code> object has a <em>verification
status</em>, which is a statement of whether the contents of the
<code>env</code> can be reproduced by <code>code</code>. From this
perspective, <code>teal_data</code> objects that are instantiated empty
are <em>verified</em> but ones instantiated with data and code are
<em>unverified</em> because the code need not be reproducible.
Obviously, <code>teal_data</code> objects instantiated with data only
are <em>unverified</em> as well.</p>
<p>When evaluating code in a <code>teal_data</code> object, the code
that is stored is the same as the code that is executed, so it is
reproducible by definition. Therefore, evaluating code in a
<code>teal_data</code> object <em>does not</em> change its verification
status.</p>
<p>The verification status is always printed when inspecting a
<code>teal_data</code> object. Also, when retrieving code, unverified
objects add a warning to the code stating that it has not passed
verification.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://insightsengineering.github.io/teal.data/">teal.data</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_empty</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/teal_data.html">teal_data</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">data_empty</span> <span class="co"># is verified</span></span></code></pre></div>
<pre><code><span><span class="co">## âœ…ï¸Ž verified teal_data object</span></span>
<span><span class="co">## <span style="color: #0000BB; font-weight: bold;">&lt;environment: 0x561b6098b930&gt;</span> ðŸ”’ </span></span>
<span><span class="co">## Parent: &lt;environment: package:teal.data&gt;</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_empty</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">data_empty</span>, <span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data_empty</span> <span class="co"># remains verified</span></span></code></pre></div>
<pre><code><span><span class="co">## âœ…ï¸Ž verified teal_data object</span></span>
<span><span class="co">## <span style="color: #0000BB; font-weight: bold;">&lt;environment: 0x561b6166ea50&gt;</span> ðŸ”’ </span></span>
<span><span class="co">## Parent: &lt;environment: package:teal.data&gt; </span></span>
<span><span class="co">## <span style="font-weight: bold;">Bindings:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span>- i: [data.frame]</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_with_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/teal_data.html">teal_data</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span>, code <span class="op">=</span> <span class="st">"i &lt;- head(iris)"</span><span class="op">)</span></span>
<span><span class="va">data_with_data</span> <span class="co"># is unverified</span></span></code></pre></div>
<pre><code><span><span class="co">## âœ– unverified teal_data object</span></span>
<span><span class="co">## <span style="color: #0000BB; font-weight: bold;">&lt;environment: 0x561b62248928&gt;</span> ðŸ”’ </span></span>
<span><span class="co">## Parent: &lt;environment: package:teal.data&gt; </span></span>
<span><span class="co">## <span style="font-weight: bold;">Bindings:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span>- i: [data.frame]</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_with_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">data_with_data</span>, <span class="va">i</span><span class="op">$</span><span class="va">rand</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data_with_data</span> <span class="co"># remains unverified</span></span></code></pre></div>
<pre><code><span><span class="co">## âœ– unverified teal_data object</span></span>
<span><span class="co">## <span style="color: #0000BB; font-weight: bold;">&lt;environment: 0x561b62997c90&gt;</span> ðŸ”’ </span></span>
<span><span class="co">## Parent: &lt;environment: package:teal.data&gt; </span></span>
<span><span class="co">## <span style="font-weight: bold;">Bindings:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span>- i: [data.frame]</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="verification-process">Verification process<a class="anchor" aria-label="anchor" href="#verification-process"></a>
</h4>
<p>In order to confirm that the code stored in <code>teal_data</code>
exactly reproduces the contents of the environment, one must run the
<code><a href="../reference/verify.html">verify()</a></code> function. This causes the code to be evaluated and
the results to be compared to the contents of the environment. If the
code executes without errors and the results are the same as the
contents already present in the environment, the verification is
successful and the objectâ€™s state will be changed to <em>verified</em>.
Otherwise an error will be raised.</p>
<div class="section level5">
<h5 id="verified">verified<a class="anchor" aria-label="anchor" href="#verified"></a>
</h5>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://insightsengineering.github.io/teal.data/">teal.data</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_right</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/teal_data.html">teal_data</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  code <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span></span>
<span>    <span class="va">data</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="co"># is unverified</span></span>
<span><span class="op">(</span><span class="va">data_right_verified</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/verify.html">verify</a></span><span class="op">(</span><span class="va">data_right</span><span class="op">)</span><span class="op">)</span> <span class="co"># returns verified object</span></span></code></pre></div>
<pre><code><span><span class="co">## âœ…ï¸Ž verified teal_data object</span></span>
<span><span class="co">## <span style="color: #0000BB; font-weight: bold;">&lt;environment: 0x561b5c132008&gt;</span> ðŸ”’ </span></span>
<span><span class="co">## Parent: &lt;environment: package:teal.data&gt; </span></span>
<span><span class="co">## <span style="font-weight: bold;">Bindings:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span>- data: [data.frame]</span></span></code></pre>
</div>
<div class="section level5">
<h5 id="unverified">unverified<a class="anchor" aria-label="anchor" href="#unverified"></a>
</h5>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_wrong</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/teal_data.html">teal_data</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  code <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/verify.html">verify</a></span><span class="op">(</span><span class="va">data_wrong</span><span class="op">)</span> <span class="co"># fails verification, raises error</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: Code verification failed.</span></span>
<span><span class="co">## Object(s) recreated with code that have different structure in data_wrong:</span></span>
<span><span class="co">##   â€¢ data</span></span></code></pre>
</div>
</div>
</div>
<div class="section level3">
<h3 id="retrieving-code">Retrieving code<a class="anchor" aria-label="anchor" href="#retrieving-code"></a>
</h3>
<p>The <code>get_code</code> function is used to retrieve the code
stored in a <code>teal_data</code> object. A simple
<code>get_code(&lt;teal_data&gt;)</code> will return the entirety of the
code but using the <code>names</code> argument allows for obtaining a
subset of the code that only deals with some of the objects stored in
<code>teal_data</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://insightsengineering.github.io/teal.data/">teal.data</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="fu"><a href="../reference/teal_data.html">teal_data</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">{</span></span>
<span>  <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">iris</span></span>
<span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">mtcars</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://insightsengineering.github.io/teal.code/latest-tag/reference/get_code.html" class="external-link">get_code</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="co"># retrieve all code</span></span></code></pre></div>
<pre><code><span><span class="co">## i &lt;- iris</span></span>
<span><span class="co">## m &lt;- mtcars</span></span>
<span><span class="co">## head(i)</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://insightsengineering.github.io/teal.code/latest-tag/reference/get_code.html" class="external-link">get_code</a></span><span class="op">(</span><span class="va">data</span>, names <span class="op">=</span> <span class="st">"i"</span><span class="op">)</span><span class="op">)</span> <span class="co"># retrieve code for `i`</span></span></code></pre></div>
<pre><code><span><span class="co">## i &lt;- iris</span></span></code></pre>
<p>Note that in when retrieving code for a specific dataset, the result
is only the code used to <em>create</em> that dataset, not code that
<em>uses</em> is.</p>
</div>
<div class="section level3">
<h3 id="tracking-object-dependencies">Tracking object dependencies<a class="anchor" aria-label="anchor" href="#tracking-object-dependencies"></a>
</h3>
<p>Calling <code>get_code</code> with <code>names</code> specified
initiates an analysis of the stored code, in which object dependencies
are automatically discovered. If object <code>x</code> is created with
an expression that uses object <code>y</code>, the lines that create
object <code>y</code> must also be returned. This is quite effective
when objects are created by simple assignments like
<code>x &lt;- foo(y)</code>. However, in rare cases discovering
dependencies is impossible, <em>e.g.</em> when opening connections to
databases or when objects are created by side effects (functions acting
on their calling environment implicitly rather than returning a value
that is then assigned). In such cases the code author must manually tag
code lines that are required for a dataset by adding a special comment
to the lines: <code># @linksto x</code> will cause the line to be
included when retrieving code for <code>x</code>.</p>
<p>See <code><a href="https://insightsengineering.github.io/teal.code/latest-tag/reference/get_code.html" class="external-link">?get_code</a></code> for a detailed explanation and
examples.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="nest">
  <p>teal.data is a part of the <strong>NEST</strong> and <a href="https://pharmaverse.org/" class="external-link"><strong>pharmaverse</strong></a>.</p>
</div>
<script type="text/javascript" src="../analytics.js"></script></footer>
</div>





  </body>
</html>
