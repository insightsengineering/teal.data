<!DOCTYPE html>
<!-- Generated by pkgdown + https://github.com/insightsengineering/r-pkgdown-multiversion -->
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="teal.data">
<title>Creating Delayed Data Classes (Advanced) • teal.data</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Creating Delayed Data Classes (Advanced)">
<meta property="og:description" content="teal.data">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><link rel="stylesheet" href="../consent.css">
<script src="../consent.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">teal.data</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    <div style="width: 140px; margin-left: 0.5rem;"> <small class="nav-text text-muted me-auto">part of</small> <img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/nest.png?raw=true" alt="NEST" style="height: 30px;"><a href="https://pharmaverse.org/" class="external-link"><img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/pharmaverse.png?raw=true" alt="pharmaverse" style="height: 28px;"></a> </div>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/teal-data.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/teal-data.html">Introduction to teal.data</a>
    <a class="dropdown-item" href="../articles/preprocessing-data.html">Pre-processing data</a>
    <a class="dropdown-item" href="../articles/preprocessing-delayed-data.html">Pre-processing Delayed Data</a>
    <a class="dropdown-item" href="../articles/reproducibility.html">Reproducibility check</a>
    <a class="dropdown-item" href="../articles/join-keys.html">Join Keys</a>
    <a class="dropdown-item" href="../articles/using-delayed-data-basic.html">Using Delayed Data Loading (Basic)</a>
    <a class="dropdown-item" href="../articles/using-delayed-data-advanced.html">Creating Delayed Data Classes (Advanced)</a>
    <a class="dropdown-item" href="../articles/testing-delayed-data.html">Examining Delayed Data Objects</a>
    <a class="dropdown-item" href="../articles/teal.data-with-python.html">teal.data with Python</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>

      <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-versions">Versions</a>
    <div class="dropdown-menu" aria-labelledby="dropdown-versions">
    <a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.data/release-candidate">release-candidate</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.data/main">main</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.data/latest-tag">latest-tag</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.data/v0.6.0">v0.6.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.data/v0.6.0-rc1">v0.6.0-rc1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.data/v0.5.0">v0.5.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.data/v0.5.0-rc1">v0.5.0-rc1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.data/v0.4.0">v0.4.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.data/v0.4.0-rc1">v0.4.0-rc1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.data/v0.3.0">v0.3.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.data/v0.2.0">v0.2.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.data/v0.1.2">v0.1.2</a>
</div>
</li>
</ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/insightsengineering/teal.data">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Creating Delayed Data Classes (Advanced)</h1>
                        <h4 data-toc-skip class="author">Dawid
Kałędkowski</h4>
            
            <h4 data-toc-skip class="date">15.05.2022</h4>
      
      
      <div class="d-none name"><code>using-delayed-data-advanced.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h3>
<p><code>teal.data</code> provides several ways to include datasets into
shiny applications. Normally, one develops an application in such a way
that the data is available before the app starts. This always involves
passing <code>data.frame</code> objects using the
<code>cdisc_data</code> or <code>teal_data</code> functions to the shiny
application. This way of building an app is applicable if data is
physically available before the app is created.</p>
<p>Including data to the shiny app as <a href="https://shiny.rstudio.com/articles/scoping.html" class="external-link">global
objects</a> means that they will be fixed and won’t change throughout
the life of the application session.</p>
<p>The other possible scenario is that data may not be available during
the creation or initialization of the application. Such data would need
to be loaded by the shiny application after being initialized, which may
also involve the entering of user name and password credentials via
shiny UI components. Delayed data loading in applications involves
specifying metadata which stores all information needed to pull the data
from the right source. In delayed data loading applications, before the
main app loads the user is prompted with data loading UI.</p>
<p>This means that delayed data applications can be two-staged:</p>
<ol style="list-style-type: decimal">
<li>Data loading app</li>
<li>Main app</li>
</ol>
</div>
<div class="section level2">
<h2 id="key-definitions">Key definitions<a class="anchor" aria-label="anchor" href="#key-definitions"></a>
</h2>
<p>The following are general descriptions for the main classes of the
<code>teal.data</code> package.</p>
<ol style="list-style-type: decimal">
<li><p><code>TealDataset</code> contains physical data in the form of a
single <code>data.frame</code> plus reproducible code.</p></li>
<li><p><code>TealDatasetConnector</code> contains instructions to obtain
a single <code>TealDataset</code> object.</p></li>
<li><p><code>TealDataConnection</code> opens and closes connections
(with remote data sources).</p></li>
<li><p><code>TealDataConnector</code> contains arbitrary many
<code>TealDatasetConnector</code> objects and optionally one
<code>TealDataConnection</code> object.</p></li>
<li><p><code>TealData</code> contains arbitrary many
<code>TealDataset</code>, <code>TealDatasetConnector</code> and / or
<code>TealDataConnector</code> objects.</p></li>
</ol>
<p>With the exception of <code>TealDataConnection</code>, all of the
above classes have their CDISC equivalent, e.g. <code>TealData</code>
-&gt; <code>CDISCTealData</code>.</p>
</div>
<div class="section level2">
<h2 id="creating-an-app">Creating an app<a class="anchor" aria-label="anchor" href="#creating-an-app"></a>
</h2>
<div class="section level3">
<h3 id="callable">
<code>Callable</code><a class="anchor" aria-label="anchor" href="#callable"></a>
</h3>
<div class="section level4">
<h4 id="callablefunction">
<code>CallableFunction</code><a class="anchor" aria-label="anchor" href="#callablefunction"></a>
</h4>
<p>This class won’t be used often by the developers but it’s essential
for all connectors to store and execute R functions with the feature to
get the code to reproduce the function calls. In the example below an
object of class <code>CallableFunction</code> is created which runs
<code>synthetic_cdisc_dataset</code> function with arguments specified
by the user.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">teal.data</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: shiny</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">scda</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="co"># initialize object</span></span>
<span><span class="va">fun</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/callable_function.html">callable_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">synthetic_cdisc_dataset</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set arguments to function</span></span>
<span><span class="va">fun</span><span class="op">$</span><span class="fu">set_args</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dataset_name <span class="op">=</span> <span class="st">"adsl"</span>, archive_name <span class="op">=</span> <span class="st">"latest"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># execute function with arguments set</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">fun</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;   STUDYID               USUBJID SUBJID SITEID AGE  AGEU SEX</span></span>
<span><span class="co">#&gt; 1 AB12345  AB12345-CHN-3-id-128 id-128  CHN-3  32 YEARS   M</span></span>
<span><span class="co">#&gt; 2 AB12345 AB12345-CHN-15-id-262 id-262 CHN-15  35 YEARS   M</span></span>
<span><span class="co">#&gt;                        RACE                 ETHNIC COUNTRY DTHFL         INVID</span></span>
<span><span class="co">#&gt; 1                     ASIAN     HISPANIC OR LATINO     CHN     Y  INV ID CHN-3</span></span>
<span><span class="co">#&gt; 2 BLACK OR AFRICAN AMERICAN NOT HISPANIC OR LATINO     CHN     N INV ID CHN-15</span></span>
<span><span class="co">#&gt;           INVNAM            ARM ARMCD         ACTARM ACTARMCD         TRT01P</span></span>
<span><span class="co">#&gt; 1  Dr. CHN-3 Doe      A: Drug X ARM A      A: Drug X    ARM A      A: Drug X</span></span>
<span><span class="co">#&gt; 2 Dr. CHN-15 Doe C: Combination ARM C C: Combination    ARM C C: Combination</span></span>
<span><span class="co">#&gt;           TRT01A     TRT02P         TRT02A REGION1 STRATA1 STRATA2    BMRKR1</span></span>
<span><span class="co">#&gt; 1      A: Drug X B: Placebo      A: Drug X    Asia       C      S2 14.424934</span></span>
<span><span class="co">#&gt; 2 C: Combination B: Placebo C: Combination    Asia       C      S1  4.055463</span></span>
<span><span class="co">#&gt;   BMRKR2 ITTFL SAFFL BMEASIFL BEP01FL AEWITHFL     RANDDT             TRTSDTM</span></span>
<span><span class="co">#&gt; 1 MEDIUM     Y     Y        Y       Y        N 2019-02-22 2019-02-24 11:09:25</span></span>
<span><span class="co">#&gt; 2    LOW     Y     Y        N       N        Y 2019-02-26 2019-02-26 09:05:10</span></span>
<span><span class="co">#&gt;               TRTEDTM           TRT01SDTM           TRT01EDTM</span></span>
<span><span class="co">#&gt; 1 2022-02-12 04:28:08 2019-02-24 11:09:25 2021-02-11 22:28:08</span></span>
<span><span class="co">#&gt; 2 2022-02-26 03:05:10 2019-02-26 09:05:10 2021-02-25 21:05:10</span></span>
<span><span class="co">#&gt;             TRT02SDTM           TRT02EDTM            AP01SDTM</span></span>
<span><span class="co">#&gt; 1 2021-02-11 22:28:08 2022-02-12 04:28:08 2019-02-24 11:09:25</span></span>
<span><span class="co">#&gt; 2 2021-02-25 21:05:10 2022-02-26 03:05:10 2019-02-26 09:05:10</span></span>
<span><span class="co">#&gt;              AP01EDTM            AP02SDTM            AP02EDTM       EOSSTT</span></span>
<span><span class="co">#&gt; 1 2021-02-11 22:28:08 2021-02-11 22:28:08 2022-02-12 04:28:08 DISCONTINUED</span></span>
<span><span class="co">#&gt; 2 2021-02-25 21:05:10 2021-02-25 21:05:10 2022-02-26 03:05:10    COMPLETED</span></span>
<span><span class="co">#&gt;         EOTSTT      EOSDT EOSDY DCSREAS      DTHDT       DTHCAUS        DTHCAT</span></span>
<span><span class="co">#&gt; 1 DISCONTINUED 2022-02-12  1084   DEATH 2022-03-06 ADVERSE EVENT ADVERSE EVENT</span></span>
<span><span class="co">#&gt; 2    COMPLETED 2022-02-26  1096    &lt;NA&gt;       &lt;NA&gt;          &lt;NA&gt;          &lt;NA&gt;</span></span>
<span><span class="co">#&gt;   LDDTHELD LDDTHGR1   LSTALVDT DTHADY ADTHAUT</span></span>
<span><span class="co">#&gt; 1       22     &lt;=30 2022-03-06   1105     Yes</span></span>
<span><span class="co">#&gt; 2       NA     &lt;NA&gt; 2022-03-17     NA    &lt;NA&gt;</span></span>
<span></span>
<span><span class="co"># check reproducible code</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">fun</span><span class="op">$</span><span class="fu">get_call</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; scda::synthetic_cdisc_dataset(dataset_name = "adsl", archive_name = "latest")</span></span></code></pre></div>
<p>It’s also possible to execute the <code>fun$run()</code> function
with arguments added on the fly in a named <code>list</code>. Dynamic
arguments won’t be reflected in the reproducible code, which will have
consequences in other places - we will get back to this in later stages
of the documentation.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># initialize object</span></span>
<span><span class="va">fun</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/callable_function.html">callable_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">synthetic_cdisc_dataset</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add arguments on the fly</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">fun</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span>args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dataset_name <span class="op">=</span> <span class="st">"adae"</span>, archive_name <span class="op">=</span> <span class="st">"latest"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;   STUDYID              USUBJID SUBJID SITEID AGE  AGEU SEX  RACE</span></span>
<span><span class="co">#&gt; 1 AB12345 AB12345-BRA-1-id-134 id-134  BRA-1  47 YEARS   M WHITE</span></span>
<span><span class="co">#&gt; 2 AB12345 AB12345-BRA-1-id-134 id-134  BRA-1  47 YEARS   M WHITE</span></span>
<span><span class="co">#&gt;                   ETHNIC COUNTRY DTHFL        INVID        INVNAM       ARM</span></span>
<span><span class="co">#&gt; 1 NOT HISPANIC OR LATINO     BRA     Y INV ID BRA-1 Dr. BRA-1 Doe A: Drug X</span></span>
<span><span class="co">#&gt; 2 NOT HISPANIC OR LATINO     BRA     Y INV ID BRA-1 Dr. BRA-1 Doe A: Drug X</span></span>
<span><span class="co">#&gt;   ARMCD    ACTARM ACTARMCD    TRT01P    TRT01A     TRT02P    TRT02A</span></span>
<span><span class="co">#&gt; 1 ARM A A: Drug X    ARM A A: Drug X A: Drug X B: Placebo A: Drug X</span></span>
<span><span class="co">#&gt; 2 ARM A A: Drug X    ARM A A: Drug X A: Drug X B: Placebo A: Drug X</span></span>
<span><span class="co">#&gt;         REGION1 STRATA1 STRATA2   BMRKR1 BMRKR2 ITTFL SAFFL BMEASIFL BEP01FL</span></span>
<span><span class="co">#&gt; 1 South America       B      S2 6.462991    LOW     Y     Y        Y       N</span></span>
<span><span class="co">#&gt; 2 South America       B      S2 6.462991    LOW     Y     Y        Y       N</span></span>
<span><span class="co">#&gt;   AEWITHFL     RANDDT             TRTSDTM             TRTEDTM</span></span>
<span><span class="co">#&gt; 1        N 2020-11-03 2020-11-04 04:08:58 2022-02-20 03:33:55</span></span>
<span><span class="co">#&gt; 2        N 2020-11-03 2020-11-04 04:08:58 2022-02-20 03:33:55</span></span>
<span><span class="co">#&gt;             TRT01SDTM           TRT01EDTM           TRT02SDTM</span></span>
<span><span class="co">#&gt; 1 2020-11-04 04:08:58 2021-02-19 21:33:55 2021-02-19 21:33:55</span></span>
<span><span class="co">#&gt; 2 2020-11-04 04:08:58 2021-02-19 21:33:55 2021-02-19 21:33:55</span></span>
<span><span class="co">#&gt;             TRT02EDTM            AP01SDTM            AP01EDTM</span></span>
<span><span class="co">#&gt; 1 2022-02-20 03:33:55 2020-11-04 04:08:58 2021-02-19 21:33:55</span></span>
<span><span class="co">#&gt; 2 2022-02-20 03:33:55 2020-11-04 04:08:58 2021-02-19 21:33:55</span></span>
<span><span class="co">#&gt;              AP02SDTM            AP02EDTM       EOSSTT       EOTSTT      EOSDT</span></span>
<span><span class="co">#&gt; 1 2021-02-19 21:33:55 2022-02-20 03:33:55 DISCONTINUED DISCONTINUED 2022-02-20</span></span>
<span><span class="co">#&gt; 2 2021-02-19 21:33:55 2022-02-20 03:33:55 DISCONTINUED DISCONTINUED 2022-02-20</span></span>
<span><span class="co">#&gt;   EOSDY DCSREAS      DTHDT       DTHCAUS        DTHCAT LDDTHELD LDDTHGR1</span></span>
<span><span class="co">#&gt; 1   473   DEATH 2022-03-16 ADVERSE EVENT ADVERSE EVENT       24     &lt;=30</span></span>
<span><span class="co">#&gt; 2   473   DEATH 2022-03-16 ADVERSE EVENT ADVERSE EVENT       24     &lt;=30</span></span>
<span><span class="co">#&gt;     LSTALVDT DTHADY ADTHAUT ASEQ AESEQ        AETERM         AELLT</span></span>
<span><span class="co">#&gt; 1 2022-03-16    496     Yes    1     1 trm B.2.1.2.1 llt B.2.1.2.1</span></span>
<span><span class="co">#&gt; 2 2022-03-16    496     Yes    2     2 trm D.1.1.4.2 llt D.1.1.4.2</span></span>
<span><span class="co">#&gt;         AEDECOD       AEHLT     AEHLGT AEBODSYS AESOC    AESEV AESER</span></span>
<span><span class="co">#&gt; 1 dcd B.2.1.2.1 hlt B.2.1.2 hlgt B.2.1   cl B.2  cl B MODERATE     N</span></span>
<span><span class="co">#&gt; 2 dcd D.1.1.4.2 hlt D.1.1.4 hlgt D.1.1   cl D.1  cl D MODERATE     N</span></span>
<span><span class="co">#&gt;              AEACN AEREL                AEOUT AESDTH AESCONG AESDISAB AESHOSP</span></span>
<span><span class="co">#&gt; 1 DOSE NOT CHANGED     N RECOVERING/RESOLVING      N       N        Y       N</span></span>
<span><span class="co">#&gt; 2 DOSE NOT CHANGED     N RECOVERING/RESOLVING      N       N        Y       N</span></span>
<span><span class="co">#&gt;   AESLIFE AESMIE TRTEMFL AECONTRT              ASTDTM              AENDTM ASTDY</span></span>
<span><span class="co">#&gt; 1       N      N       Y        Y 2021-04-15 04:08:58 2021-10-04 04:08:58   162</span></span>
<span><span class="co">#&gt; 2       N      N       Y        N 2021-05-19 04:08:58 2021-10-31 04:08:58   196</span></span>
<span><span class="co">#&gt;   AENDY            LDOSEDTM    LDRELTM AETOXGR SMQ01NAM SMQ02NAM SMQ01SC</span></span>
<span><span class="co">#&gt; 1   334 2020-11-07 09:05:04 228663.896       3     &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2   361 2021-05-17 07:21:09   2687.814       3     &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt;</span></span>
<span><span class="co">#&gt;   SMQ02SC CQ01NAM ANL01FL           AERELNST          AEACNOTH</span></span>
<span><span class="co">#&gt; 1    &lt;NA&gt;    &lt;NA&gt;       Y               NONE PROCEDURE/SURGERY</span></span>
<span><span class="co">#&gt; 2    &lt;NA&gt;    &lt;NA&gt;       Y CONCURRENT ILLNESS        MEDICATION</span></span>
<span></span>
<span><span class="co"># dynamic arguments not reflected in the call</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">fun</span><span class="op">$</span><span class="fu">get_call</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; scda::synthetic_cdisc_dataset()</span></span></code></pre></div>
<p><code>CallableFunction</code> can also depend on other R objects as
the example function below depends on <code>ADSL</code>. The function
can be executed in specific environment where we can copy objects needed
to execute a call. To include objects in the function call, one has to
use <code>$assign_to_env()</code> to copy the object and
<code>$set_args(list(ADSL = as.name(ADSL)))</code> to link the object
with function argument.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adsl_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scda/man/synthetic_cdisc_dataset.html" class="external-link">synthetic_cdisc_dataset</a></span><span class="op">(</span>dataset_name <span class="op">=</span> <span class="st">"adsl"</span>, archive_name <span class="op">=</span> <span class="st">"latest"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fun</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/callable_function.html">callable_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">adsl</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">adsl_2</span> <span class="op">&lt;-</span> <span class="va">adsl</span></span>
<span>  <span class="va">adsl_2</span><span class="op">$</span><span class="va">new_col</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>  <span class="va">adsl_2</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># copy adsl to CallableFunction environment</span></span>
<span><span class="va">fun</span><span class="op">$</span><span class="fu">assign_to_env</span><span class="op">(</span><span class="st">"adsl"</span>, <span class="va">adsl_raw</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set arguments</span></span>
<span><span class="va">fun</span><span class="op">$</span><span class="fu">set_args</span><span class="op">(</span>args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>adsl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/name.html" class="external-link">as.name</a></span><span class="op">(</span><span class="st">"adsl"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># execute function</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">fun</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;   STUDYID               USUBJID SUBJID SITEID AGE  AGEU SEX</span></span>
<span><span class="co">#&gt; 1 AB12345  AB12345-CHN-3-id-128 id-128  CHN-3  32 YEARS   M</span></span>
<span><span class="co">#&gt; 2 AB12345 AB12345-CHN-15-id-262 id-262 CHN-15  35 YEARS   M</span></span>
<span><span class="co">#&gt;                        RACE                 ETHNIC COUNTRY DTHFL         INVID</span></span>
<span><span class="co">#&gt; 1                     ASIAN     HISPANIC OR LATINO     CHN     Y  INV ID CHN-3</span></span>
<span><span class="co">#&gt; 2 BLACK OR AFRICAN AMERICAN NOT HISPANIC OR LATINO     CHN     N INV ID CHN-15</span></span>
<span><span class="co">#&gt;           INVNAM            ARM ARMCD         ACTARM ACTARMCD         TRT01P</span></span>
<span><span class="co">#&gt; 1  Dr. CHN-3 Doe      A: Drug X ARM A      A: Drug X    ARM A      A: Drug X</span></span>
<span><span class="co">#&gt; 2 Dr. CHN-15 Doe C: Combination ARM C C: Combination    ARM C C: Combination</span></span>
<span><span class="co">#&gt;           TRT01A     TRT02P         TRT02A REGION1 STRATA1 STRATA2    BMRKR1</span></span>
<span><span class="co">#&gt; 1      A: Drug X B: Placebo      A: Drug X    Asia       C      S2 14.424934</span></span>
<span><span class="co">#&gt; 2 C: Combination B: Placebo C: Combination    Asia       C      S1  4.055463</span></span>
<span><span class="co">#&gt;   BMRKR2 ITTFL SAFFL BMEASIFL BEP01FL AEWITHFL     RANDDT             TRTSDTM</span></span>
<span><span class="co">#&gt; 1 MEDIUM     Y     Y        Y       Y        N 2019-02-22 2019-02-24 11:09:25</span></span>
<span><span class="co">#&gt; 2    LOW     Y     Y        N       N        Y 2019-02-26 2019-02-26 09:05:10</span></span>
<span><span class="co">#&gt;               TRTEDTM           TRT01SDTM           TRT01EDTM</span></span>
<span><span class="co">#&gt; 1 2022-02-12 04:28:08 2019-02-24 11:09:25 2021-02-11 22:28:08</span></span>
<span><span class="co">#&gt; 2 2022-02-26 03:05:10 2019-02-26 09:05:10 2021-02-25 21:05:10</span></span>
<span><span class="co">#&gt;             TRT02SDTM           TRT02EDTM            AP01SDTM</span></span>
<span><span class="co">#&gt; 1 2021-02-11 22:28:08 2022-02-12 04:28:08 2019-02-24 11:09:25</span></span>
<span><span class="co">#&gt; 2 2021-02-25 21:05:10 2022-02-26 03:05:10 2019-02-26 09:05:10</span></span>
<span><span class="co">#&gt;              AP01EDTM            AP02SDTM            AP02EDTM       EOSSTT</span></span>
<span><span class="co">#&gt; 1 2021-02-11 22:28:08 2021-02-11 22:28:08 2022-02-12 04:28:08 DISCONTINUED</span></span>
<span><span class="co">#&gt; 2 2021-02-25 21:05:10 2021-02-25 21:05:10 2022-02-26 03:05:10    COMPLETED</span></span>
<span><span class="co">#&gt;         EOTSTT      EOSDT EOSDY DCSREAS      DTHDT       DTHCAUS        DTHCAT</span></span>
<span><span class="co">#&gt; 1 DISCONTINUED 2022-02-12  1084   DEATH 2022-03-06 ADVERSE EVENT ADVERSE EVENT</span></span>
<span><span class="co">#&gt; 2    COMPLETED 2022-02-26  1096    &lt;NA&gt;       &lt;NA&gt;          &lt;NA&gt;          &lt;NA&gt;</span></span>
<span><span class="co">#&gt;   LDDTHELD LDDTHGR1   LSTALVDT DTHADY ADTHAUT new_col</span></span>
<span><span class="co">#&gt; 1       22     &lt;=30 2022-03-06   1105     Yes    TRUE</span></span>
<span><span class="co">#&gt; 2       NA     &lt;NA&gt; 2022-03-17     NA    &lt;NA&gt;    TRUE</span></span>
<span></span>
<span><span class="co"># get R code</span></span>
<span><span class="va">fun</span><span class="op">$</span><span class="fu">get_call</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "(function(adsl) {\n    adsl_2 &lt;- adsl\n    adsl_2$new_col &lt;- TRUE\n    adsl_2\n})(adsl = adsl)"</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="callablecode">
<code>CallableCode</code><a class="anchor" aria-label="anchor" href="#callablecode"></a>
</h3>
<p>A simpler version of the <code>Callable</code> class is
<code>CallableCode</code>. Similar to <code>CallableFunction</code>,
<code>CallableCode</code> stores code which can be evaluated using
<code>run()</code> but it isn’t able to use dynamic arguments to make
the code more general. <code>CallableCode</code> also allows the
assignment of objects to its environment. <code>CallableCode</code> can
contain multiple lines (commands) of code and also allows
<code>library</code> calls. Please note that objects assigned to this
independent environment can’t be modified because they are locked
immediately. This means that the <code>CallableCode</code> created below
is not allowed to make any changes to <code>x1</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">code</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/callable_code.html">callable_code</a></span><span class="op">(</span></span>
<span>  <span class="st">"library(scda)</span></span>
<span><span class="st">  ADTTE &lt;- synthetic_cdisc_dataset(dataset_name = \"adtte\", archive_name = \"latest\")</span></span>
<span><span class="st">  ADTTE$x1 &lt;- x1</span></span>
<span><span class="st">  ADTTE &lt;- dplyr::filter(ADTTE, PARAMCD %in% c('EFS', 'OS'))"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># examine call</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">code</span><span class="op">$</span><span class="fu">get_call</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; library(scda)</span></span>
<span><span class="co">#&gt; ADTTE &lt;- synthetic_cdisc_dataset(dataset_name = "adtte", archive_name = "latest")</span></span>
<span><span class="co">#&gt; ADTTE$x1 &lt;- x1</span></span>
<span><span class="co">#&gt; ADTTE &lt;- dplyr::filter(ADTTE, PARAMCD %in% c("EFS", "OS"))</span></span>
<span></span>
<span><span class="co"># assign x1 to environment (otherwise code would run with error as x1 would not be defined)</span></span>
<span><span class="va">code</span><span class="op">$</span><span class="fu">assign_to_env</span><span class="op">(</span><span class="st">"x1"</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># evaluate call</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">code</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">x1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1 1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="tealdataset-base-class-which-cdisctealdataset-inherits-from">
<code>TealDataset</code> (base class which
<code>CDISCTealDataset</code> inherits from)<a class="anchor" aria-label="anchor" href="#tealdataset-base-class-which-cdisctealdataset-inherits-from"></a>
</h3>
<p><code>TealDataset</code> is an R6 class which keeps a
<code>data.frame</code> in its <code>raw_data</code> slot. One can
create a <code>TealDataset</code> by including <code>data.frame</code>
and setting data attributes. In the example below we first create
<code>adsl</code> and then put this <code>data.frame</code> into the
<code>cdisc_dataset</code> function. Together with
<code>data.frame</code> one should also provide a <code>dataname</code>
and optional <code>code</code> to reproduce the data if reproducibility
is required.</p>
<p>Note <code>cdisc_dataset</code> returns an object of
<code>CDISCTealDataset</code>, which is needed for CDISC analysis.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">adsl_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scda/man/synthetic_cdisc_dataset.html" class="external-link">synthetic_cdisc_dataset</a></span><span class="op">(</span>dataset_name <span class="op">=</span> <span class="st">"adsl"</span>, archive_name <span class="op">=</span> <span class="st">"latest"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adsl_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cdisc_dataset.html">cdisc_dataset</a></span><span class="op">(</span></span>
<span>  dataname <span class="op">=</span> <span class="st">"ADSL"</span>,</span>
<span>  x <span class="op">=</span> <span class="va">adsl_raw</span>,</span>
<span>  code <span class="op">=</span> <span class="st">"ADSL &lt;- synthetic_cdisc_dataset(dataset_name = \"adsl\", archive_name = \"latest\") %&gt;% head(3)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The object created above contains all previously defined attributes
which can be extracted.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check if code is reproducible</span></span>
<span><span class="fu"><a href="../reference/get_dataname.html">get_dataname</a></span><span class="op">(</span><span class="va">adsl_dataset</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "ADSL"</span></span>
<span></span>
<span><span class="co"># get label</span></span>
<span><span class="fu"><a href="../reference/get_dataset_label.html">get_dataset_label</a></span><span class="op">(</span><span class="va">adsl_dataset</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Subject Level Analysis Dataset"</span></span>
<span></span>
<span><span class="co"># get reproducible code</span></span>
<span><span class="fu"><a href="../reference/get_code.html">get_code</a></span><span class="op">(</span><span class="va">adsl_dataset</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "ADSL &lt;- synthetic_cdisc_dataset(dataset_name = \"adsl\", archive_name = \"latest\") %&gt;% head(3)"</span></span>
<span></span>
<span><span class="co"># get data.frame</span></span>
<span><span class="fu"><a href="../reference/get_raw_data.html">get_raw_data</a></span><span class="op">(</span><span class="va">adsl_dataset</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 55</span></span></span>
<span><span class="co">#&gt;   STUDYID USUBJID     SUBJID SITEID   AGE AGEU  SEX   RACE  ETHNIC COUNTRY DTHFL</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> AB12345 AB12345-CH… id-128 CHN-3     32 YEARS M     ASIAN HISPA… CHN     Y    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> AB12345 AB12345-CH… id-262 CHN-15    35 YEARS M     BLAC… NOT H… CHN     N    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> AB12345 AB12345-RU… id-378 RUS-3     30 YEARS F     ASIAN NOT H… RUS     N    </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 44 more variables: INVID &lt;chr&gt;, INVNAM &lt;chr&gt;, ARM &lt;fct&gt;, ARMCD &lt;fct&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ACTARM &lt;fct&gt;, ACTARMCD &lt;fct&gt;, TRT01P &lt;fct&gt;, TRT01A &lt;fct&gt;, TRT02P &lt;fct&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   TRT02A &lt;fct&gt;, REGION1 &lt;fct&gt;, STRATA1 &lt;fct&gt;, STRATA2 &lt;fct&gt;, BMRKR1 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   BMRKR2 &lt;fct&gt;, ITTFL &lt;fct&gt;, SAFFL &lt;fct&gt;, BMEASIFL &lt;fct&gt;, BEP01FL &lt;fct&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   AEWITHFL &lt;fct&gt;, RANDDT &lt;date&gt;, TRTSDTM &lt;dttm&gt;, TRTEDTM &lt;dttm&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   TRT01SDTM &lt;dttm&gt;, TRT01EDTM &lt;dttm&gt;, TRT02SDTM &lt;dttm&gt;, TRT02EDTM &lt;dttm&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   AP01SDTM &lt;dttm&gt;, AP01EDTM &lt;dttm&gt;, AP02SDTM &lt;dttm&gt;, AP02EDTM &lt;dttm&gt;, …</span></span></span>
<span></span>
<span><span class="co"># get keys (i.e. the primary keys of the dataset)</span></span>
<span><span class="va">adsl_dataset</span><span class="op">$</span><span class="fu">get_keys</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "STUDYID" "USUBJID"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="tealdatasetconnector-base-class-which-cdisctealdatasetconnector-inherits-from">
<code>TealDatasetConnector</code> (base class which
<code>CDISCTealDatasetConnector</code> inherits from)<a class="anchor" aria-label="anchor" href="#tealdatasetconnector-base-class-which-cdisctealdatasetconnector-inherits-from"></a>
</h3>
<p><code>TealDatasetConnector</code> contains a <code>Callable</code>
object to obtain a single <code>TealDataset</code> object. In the code
chunk below, a connector is created based on the
<code>synthetic_cdisc_dataset</code> function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adsl_conn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dataset_connector.html">dataset_connector</a></span><span class="op">(</span></span>
<span>  dataname <span class="op">=</span> <span class="st">"ADSL"</span>,</span>
<span>  pull_callable <span class="op">=</span> <span class="fu"><a href="../reference/callable_function.html">callable_function</a></span><span class="op">(</span><span class="st">"synthetic_cdisc_dataset"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/set_args.html">set_args</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dataset_name <span class="op">=</span> <span class="st">"adsl"</span>, archive_name <span class="op">=</span> <span class="st">"latest"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  keys <span class="op">=</span> <span class="fu"><a href="../reference/get_cdisc_keys.html">get_cdisc_keys</a></span><span class="op">(</span><span class="st">"ADSL"</span><span class="op">)</span>,</span>
<span>  label <span class="op">=</span> <span class="st">"Subject-Level Analysis Dataset"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Initially, <code>adsl_conn</code> doesn’t contain any data.
Attempting to fetch unavailable data will produce an error.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get raw data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_raw_data.html">get_raw_data</a></span><span class="op">(</span><span class="va">adsl_conn</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error : 'ADSL' has not been pulled yet</span></span>
<span><span class="co">#&gt;  - please use `load_dataset()` first.</span></span></code></pre></div>
<p>Data can be loaded using <code><a href="../reference/load_dataset.html">load_dataset()</a></code> function. Before
data is loaded, <code>adsl_conn</code> contains reproducible code which
is also the code to pull the data.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># execution/reproducible code</span></span>
<span><span class="fu"><a href="../reference/get_code.html">get_code</a></span><span class="op">(</span><span class="va">adsl_conn</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "ADSL &lt;- scda::synthetic_cdisc_dataset(dataset_name = \"adsl\", archive_name = \"latest\")"</span></span>
<span></span>
<span><span class="co"># pull data</span></span>
<span><span class="fu"><a href="../reference/load_dataset.html">load_dataset</a></span><span class="op">(</span><span class="va">adsl_conn</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get raw data</span></span>
<span><span class="fu"><a href="../reference/get_raw_data.html">get_raw_data</a></span><span class="op">(</span><span class="va">adsl_conn</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 400 × 55</span></span></span>
<span><span class="co">#&gt;    STUDYID USUBJID    SUBJID SITEID   AGE AGEU  SEX   RACE  ETHNIC COUNTRY DTHFL</span></span>
<span><span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> AB12345 AB12345-C… id-128 CHN-3     32 YEARS M     ASIAN HISPA… CHN     Y    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> AB12345 AB12345-C… id-262 CHN-15    35 YEARS M     BLAC… NOT H… CHN     N    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> AB12345 AB12345-R… id-378 RUS-3     30 YEARS F     ASIAN NOT H… RUS     N    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> AB12345 AB12345-C… id-220 CHN-11    26 YEARS F     ASIAN NOT H… CHN     N    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> AB12345 AB12345-C… id-267 CHN-7     40 YEARS M     ASIAN NOT H… CHN     N    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> AB12345 AB12345-C… id-201 CHN-15    49 YEARS M     ASIAN NOT H… CHN     Y    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> AB12345 AB12345-U… id-45  USA-1     34 YEARS F     ASIAN NOT H… USA     N    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> AB12345 AB12345-U… id-261 USA-1     32 YEARS F     ASIAN NOT H… USA     N    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> AB12345 AB12345-N… id-173 NGA-11    24 YEARS F     BLAC… NOT H… NGA     N    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> AB12345 AB12345-C… id-307 CHN-1     24 YEARS M     ASIAN NOT H… CHN     Y    </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 390 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 44 more variables: INVID &lt;chr&gt;, INVNAM &lt;chr&gt;, ARM &lt;fct&gt;, ARMCD &lt;fct&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ACTARM &lt;fct&gt;, ACTARMCD &lt;fct&gt;, TRT01P &lt;fct&gt;, TRT01A &lt;fct&gt;, TRT02P &lt;fct&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   TRT02A &lt;fct&gt;, REGION1 &lt;fct&gt;, STRATA1 &lt;fct&gt;, STRATA2 &lt;fct&gt;, BMRKR1 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   BMRKR2 &lt;fct&gt;, ITTFL &lt;fct&gt;, SAFFL &lt;fct&gt;, BMEASIFL &lt;fct&gt;, BEP01FL &lt;fct&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   AEWITHFL &lt;fct&gt;, RANDDT &lt;date&gt;, TRTSDTM &lt;dttm&gt;, TRTEDTM &lt;dttm&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   TRT01SDTM &lt;dttm&gt;, TRT01EDTM &lt;dttm&gt;, TRT02SDTM &lt;dttm&gt;, TRT02EDTM &lt;dttm&gt;, …</span></span></span></code></pre></div>
<p><code>TealDatasetConnector</code> also allows other variables to be
passed to its <code>Callable</code> object that may depend on them. In
the code below the <code>adsl_raw</code> object - created above - is
added to the <code>CallableFunction</code>. To properly link the
<code>ADSL</code> argument of the function inside the
<code>CallableFunction</code> object with the raw data
<code>adsl_raw</code> several parameters have to match:</p>
<ol style="list-style-type: decimal">
<li>
<code>as.name("dummy_name")</code> must be the value with name
<code>"ADSL"</code> -
<code>set_args(list(ADSL = as.name("dummy_name")))</code>
</li>
<li>and then <code>dummy_name</code> must be linked with the raw data
<code>adsl_raw</code> -
<code>vars = list(dummy_name = adsl_raw)</code>
</li>
</ol>
<p>The name <code>ADSL</code> is fixed because it is the name of the
argument of the function inside of the <code>CallableFunction</code>.
The name <code>dummy_name</code> is free to be any valid <code>R</code>
name.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># here we use the general dataset_connector function which pulls an object of type TealDataset</span></span>
<span><span class="co"># there is also a cdisc_dataset_connector function which pulls an object of type CDISCTealDataset</span></span>
<span><span class="va">adsl_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dataset_connector.html">dataset_connector</a></span><span class="op">(</span></span>
<span>  dataname <span class="op">=</span> <span class="st">"ADSL_2"</span>,</span>
<span>  pull_callable <span class="op">=</span> <span class="fu"><a href="../reference/callable_function.html">callable_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">ADSL</span><span class="op">)</span> <span class="va">ADSL_2</span> <span class="op">&lt;-</span> <span class="va">ADSL</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># nolint</span></span>
<span>    <span class="fu"><a href="../reference/set_args.html">set_args</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ADSL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/name.html" class="external-link">as.name</a></span><span class="op">(</span><span class="st">"dummy_name"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  keys <span class="op">=</span> <span class="fu"><a href="../reference/get_cdisc_keys.html">get_cdisc_keys</a></span><span class="op">(</span><span class="st">"ADSL"</span><span class="op">)</span>,</span>
<span>  label <span class="op">=</span> <span class="st">"Example label"</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dummy_name <span class="op">=</span> <span class="va">adsl_raw</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/load_dataset.html">load_dataset</a></span><span class="op">(</span><span class="va">adsl_2</span><span class="op">)</span></span></code></pre></div>
<p><code>TealDatasetConnector</code> like the other delayed data objects
contains a <code>launch</code> method which can be used to obtain data
using shiny application. This function can be used to check if the
objects are specified correctly and to investigate potential mistakes.
By default the shiny app won’t render any inputs for datasets until we
specify them. To set inputs we should use <code>$set_ui_input()</code>,
by passing ui module function, with <code>ns</code> argument
(<code>shiny</code> namespace ID object). In the example below, the
<code>callable_function</code> object contains two arguments,
<code>ADSL</code> and <code>n</code>. <code>ADSL</code> is given while
<code>n</code> is entered from a shiny app after the <code>launch</code>
method is called.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adsl_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dataset_connector.html">dataset_connector</a></span><span class="op">(</span></span>
<span>  dataname <span class="op">=</span> <span class="st">"ADSL_3"</span>,</span>
<span>  pull_callable <span class="op">=</span> <span class="fu"><a href="../reference/callable_function.html">callable_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">ADSL</span>, <span class="va">n</span><span class="op">)</span> <span class="va">ADSL_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ADSL</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># nolint</span></span>
<span>    <span class="fu"><a href="../reference/set_args.html">set_args</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ADSL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/name.html" class="external-link">as.name</a></span><span class="op">(</span><span class="st">"ADSL"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  keys <span class="op">=</span> <span class="fu"><a href="../reference/get_cdisc_keys.html">get_cdisc_keys</a></span><span class="op">(</span><span class="st">"ADSL"</span><span class="op">)</span>,</span>
<span>  label <span class="op">=</span> <span class="st">"Example label"</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ADSL <span class="op">=</span> <span class="va">adsl_raw</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">adsl_3</span><span class="op">$</span><span class="fu">set_ui_input</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">ns</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/numericInput.html" class="external-link">numericInput</a></span><span class="op">(</span>inputId <span class="op">=</span> <span class="fu">ns</span><span class="op">(</span><span class="st">"n"</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"Choose number of records"</span>, min <span class="op">=</span> <span class="fl">0</span>, value <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">adsl_3</span><span class="op">$</span><span class="fu">launch</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="tealdataconnection">
<code>TealDataConnection</code><a class="anchor" aria-label="anchor" href="#tealdataconnection"></a>
</h3>
<p>Objects of this class are responsible to set a connection with remote
data sources. <code>TealDataConnection</code> opens and closes
connections by calling <code>CallableFunction</code> with the
appropriate arguments.</p>
<p>Note that if an app pulls data from a remote source, then the outputs
will change even if the code is the same if the data in the remote
source changes.</p>
<p>In <code>shiny</code> applications, connection arguments need to be
linked with <code>inputs</code>, which is why
<code>TealDataConnection</code> contains a module. Developers can
customize UI inputs to open the connection using
<code>set_open_ui()</code> and specify a relevant server function using
<code>set_open_server()</code>. It’s important to keep in mind that the
server module needs a connection as an argument to <code><a href="https://rdrr.io/r/base/connections.html" class="external-link">open()</a></code>
and <code><a href="https://rdrr.io/r/base/connections.html" class="external-link">close()</a></code> if needed.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">open_fun</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/callable_function.html">callable_function</a></span><span class="op">(</span><span class="va">data.frame</span><span class="op">)</span> <span class="co"># define opening function</span></span>
<span><span class="va">open_fun</span><span class="op">$</span><span class="fu">set_args</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="co"># define fixed arguments to opening function</span></span>
<span></span>
<span><span class="va">close_fun</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/callable_function.html">callable_function</a></span><span class="op">(</span><span class="va">sum</span><span class="op">)</span> <span class="co"># define closing function</span></span>
<span><span class="va">close_fun</span><span class="op">$</span><span class="fu">set_args</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="co"># define fixed arguments to closing function</span></span>
<span></span>
<span><span class="va">ping_fun</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/callable_function.html">callable_function</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_connection.html">data_connection</a></span><span class="op">(</span></span>
<span>  ping_fun <span class="op">=</span> <span class="va">ping_fun</span>, <span class="co"># define ping function</span></span>
<span>  open_fun <span class="op">=</span> <span class="va">open_fun</span>, <span class="co"># define opening function</span></span>
<span>  close_fun <span class="op">=</span> <span class="va">close_fun</span> <span class="co"># define closing function</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="tealdataconnector-base-class-which-cdisctealdataconnector-inherits-from">
<code>TealDataConnector</code> (base class which
<code>CDISCTealDataConnector</code> inherits from)<a class="anchor" aria-label="anchor" href="#tealdataconnector-base-class-which-cdisctealdataconnector-inherits-from"></a>
</h3>
<p>This class combines multiple <code>TealDatasetConnector</code> (or
<code>CDISCTealDatasetConnector</code>) and a single
<code>TealDataConnection</code> object. It creates a module to manage
connection and to load data. Below we create two
<code>TealDatasetConnector</code> objects and a
<code>TealDataConnection</code> object and we combine them together in a
<code>TealDataConnector</code> object.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create TealDatasetConnectors</span></span>
<span><span class="va">adsl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dataset_connector.html">dataset_connector</a></span><span class="op">(</span></span>
<span>  dataname <span class="op">=</span> <span class="st">"ADSL"</span>,</span>
<span>  pull_callable <span class="op">=</span> <span class="fu"><a href="../reference/callable_function.html">callable_function</a></span><span class="op">(</span><span class="st">"synthetic_cdisc_dataset"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/set_args.html">set_args</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dataset_name <span class="op">=</span> <span class="st">"adsl"</span>, archive_name <span class="op">=</span> <span class="st">"latest"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  keys <span class="op">=</span> <span class="fu"><a href="../reference/get_cdisc_keys.html">get_cdisc_keys</a></span><span class="op">(</span><span class="st">"ADSL"</span><span class="op">)</span>,</span>
<span>  label <span class="op">=</span> <span class="st">"Subject-Level Analysis Dataset"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">adsl_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dataset_connector.html">dataset_connector</a></span><span class="op">(</span></span>
<span>  dataname <span class="op">=</span> <span class="st">"ADSL_3"</span>,</span>
<span>  pull_callable <span class="op">=</span> <span class="fu"><a href="../reference/callable_function.html">callable_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">ADSL</span>, <span class="va">archive_name</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">{</span> <span class="co"># nolint</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"slicing data from"</span>, <span class="va">archive_name</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">ADSL_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ADSL</span>, <span class="va">n</span><span class="op">)</span> <span class="co"># nolint</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/set_args.html">set_args</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ADSL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/name.html" class="external-link">as.name</a></span><span class="op">(</span><span class="st">"ADSL"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  keys <span class="op">=</span> <span class="fu"><a href="../reference/get_cdisc_keys.html">get_cdisc_keys</a></span><span class="op">(</span><span class="st">"ADSL"</span><span class="op">)</span>,</span>
<span>  label <span class="op">=</span> <span class="st">"Example label"</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ADSL <span class="op">=</span> <span class="va">adsl</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">adsl_3</span><span class="op">$</span><span class="fu">set_ui_input</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">ns</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/numericInput.html" class="external-link">numericInput</a></span><span class="op">(</span>inputId <span class="op">=</span> <span class="fu">ns</span><span class="op">(</span><span class="st">"n"</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"Choose number of records"</span>, min <span class="op">=</span> <span class="fl">0</span>, value <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">connectors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">adsl</span>, <span class="va">adsl_3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create connection</span></span>
<span><span class="va">scda_open_fun</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/callable_function.html">callable_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">library</span><span class="op">)</span></span>
<span><span class="va">scda_open_fun</span><span class="op">$</span><span class="fu">set_args</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"scda"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">scda_conn</span> <span class="op">&lt;-</span> <span class="fu">teal.data</span><span class="fu">:::</span><span class="va"><a href="../reference/TealDataConnection.html">TealDataConnection</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>open_fun <span class="op">=</span> <span class="va">scda_open_fun</span><span class="op">)</span> <span class="co"># nolint</span></span>
<span></span>
<span><span class="co"># create TealDataConnector</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">teal.data</span><span class="fu">:::</span><span class="va"><a href="../reference/TealDataConnector.html">TealDataConnector</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  connection <span class="op">=</span> <span class="va">scda_conn</span>,</span>
<span>  connectors <span class="op">=</span> <span class="va">connectors</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The object created above can be used to pull data and obtain the
code. It combines code to pull the datasets preceded by any open
connection code and followed by any close connection code. Please note
that <code>TealDataConnector</code> doesn’t limit what kind of
connectors are set within, but one must be aware that it should rather
contain similar connectors (i.e. calling functions which share some
arguments). For example, if we execute
<code>data$set_pull_args(args = list(archive_name = "latest"))</code>,
this argument will be set for all connectors. In case when any connector
contains a <code>CallableFunction</code> which doesn’t have
<code>archive_name</code> in its formals then it will fail.
<code>CallableCode</code> can’t hold any additional arguments as it’s
fixed and it will ignore every arguments set with
<code>set_pull_args</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_code.html">get_code</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; library(package = "scda")</span></span>
<span><span class="co">#&gt; ADSL &lt;- scda::synthetic_cdisc_dataset(dataset_name = "adsl", archive_name = "latest")</span></span>
<span><span class="co">#&gt; ADSL_3 &lt;- (function(ADSL, archive_name, n = 5) {</span></span>
<span><span class="co">#&gt;     print(paste("slicing data from", archive_name))</span></span>
<span><span class="co">#&gt;     ADSL_3 &lt;- head(ADSL, n)</span></span>
<span><span class="co">#&gt; })(ADSL = ADSL)</span></span>
<span></span>
<span><span class="co"># pull ADSL and ADSL_3</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="fu">set_pull_args</span><span class="op">(</span>args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>archive_name <span class="op">=</span> <span class="st">"latest"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="fu">pull</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "slicing data from latest"</span></span></code></pre></div>
<p>By default <code>TealDataConnector</code> creates simple shiny module
without any inputs to the arguments for the
<code>callable_function</code> of the connectors. This means that,
opening, closing, and pulling datasets are done on default arguments.
However, users can easily extend the module using <code>set_ui()</code>
and <code>set_server()</code> to specify the UI and server function
themselves. The general rule for creating these modules is that callback
from server to UI is not possible, because server module is executed
after the submit button is clicked. But see
<code>set_preopen_server</code> of <code>TealDataConnection</code>
object for a slight relaxation of this rule. Below we extend the app
interface by adding a text input which will be passed to the
<code>scda</code> function. The UI is created from
<code>scda_conn</code> and <code>connectors</code> object while the
server module requires <code>connectors</code> and
<code>connection</code> objects as additional arguments.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span><span class="op">$</span><span class="fu">set_ui</span><span class="op">(</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">id</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/NS.html" class="external-link">NS</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/tagList.html" class="external-link">tagList</a></span><span class="op">(</span></span>
<span>      <span class="va">scda_conn</span><span class="op">$</span><span class="fu">get_open_ui</span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">"open_connection"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textInput.html" class="external-link">textInput</a></span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span>, <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">p</a></span><span class="op">(</span><span class="st">"Choose"</span>, <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">code</a></span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span><span class="op">)</span>, value <span class="op">=</span> <span class="st">"latest"</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span></span>
<span>        what <span class="op">=</span> <span class="st">"tagList"</span>,</span>
<span>        args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>          <span class="va">connectors</span>,</span>
<span>          <span class="kw">function</span><span class="op">(</span><span class="va">connector</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">div</a></span><span class="op">(</span></span>
<span>              <span class="va">connector</span><span class="op">$</span><span class="fu">get_ui</span><span class="op">(</span></span>
<span>                id <span class="op">=</span> <span class="fu">ns</span><span class="op">(</span><span class="va">connector</span><span class="op">$</span><span class="fu">get_dataname</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>              <span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">br</a></span><span class="op">(</span><span class="op">)</span></span>
<span>            <span class="op">)</span></span>
<span>          <span class="op">}</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span><span class="op">$</span><span class="fu">set_server</span><span class="op">(</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">id</span>, <span class="va">connection</span>, <span class="va">connectors</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/moduleServer.html" class="external-link">moduleServer</a></span><span class="op">(</span></span>
<span>      id <span class="op">=</span> <span class="va">id</span>,</span>
<span>      module <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co"># opens connection</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">connection</span><span class="op">$</span><span class="fu">get_open_server</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">connection</span><span class="op">$</span><span class="fu">get_open_server</span><span class="op">(</span><span class="op">)</span><span class="op">(</span></span>
<span>            id <span class="op">=</span> <span class="st">"open_connection"</span>,</span>
<span>            connection <span class="op">=</span> <span class="va">connection</span></span>
<span>          <span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="kw">for</span> <span class="op">(</span><span class="va">connector</span> <span class="kw">in</span> <span class="va">connectors</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="co"># set_args before to return them in the code (fixed args)</span></span>
<span>          <span class="fu"><a href="../reference/set_args.html">set_args</a></span><span class="op">(</span><span class="va">connector</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>archive_name <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">)</span></span>
<span>          <span class="co"># pull each dataset</span></span>
<span>          <span class="va">connector</span><span class="op">$</span><span class="fu">get_server</span><span class="op">(</span><span class="op">)</span><span class="op">(</span>id <span class="op">=</span> <span class="va">connector</span><span class="op">$</span><span class="fu">get_dataname</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>          <span class="kw">if</span> <span class="op">(</span><span class="va">connector</span><span class="op">$</span><span class="fu">is_failed</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="kw">break</span></span>
<span>          <span class="op">}</span></span>
<span>        <span class="op">}</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Executing <code>data$launch()</code> will open a shiny application
that prompts the user for input to load the data. Remember that data can
be loaded only once. So if you run the code to <code>data$pull()</code>
above please reinitialize the connectors, connection and data object
again before running the code below.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="fu">launch</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="tealdata-base-class-which-cdisctealdata-inherits-from">
<code>TealData</code> (base class which <code>CDISCTealData</code>
inherits from)<a class="anchor" aria-label="anchor" href="#tealdata-base-class-which-cdisctealdata-inherits-from"></a>
</h3>
<p><code>TealData</code> manages <code>TealDataset</code>,
<code>TealDatasetConnector</code> and / or
<code>TealDataConnector</code> objects. <code>CDISCTealData</code> is
the equivalent object when creating apps to analyze CDISC data. These
objects are created using <code>teal_data</code> and
<code>cdisc_data</code> respectively. When using the <code>teal</code>
package these objects are passed as the <code>data</code> argument into
<code>init</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cdisc_data.html">cdisc_data</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/cdisc_dataset.html">cdisc_dataset</a></span><span class="op">(</span></span>
<span>    dataname <span class="op">=</span> <span class="st">"ADSL"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/scda/man/synthetic_cdisc_dataset.html" class="external-link">synthetic_cdisc_dataset</a></span><span class="op">(</span>dataset_name <span class="op">=</span> <span class="st">"adsl"</span>, archive_name <span class="op">=</span> <span class="st">"latest"</span><span class="op">)</span>,</span>
<span>    code <span class="op">=</span> <span class="st">"ADSL &lt;- synthetic_cdisc_dataset(dataset_name = \"adsl\", archive_name = \"latest\")"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/cdisc_dataset.html">cdisc_dataset</a></span><span class="op">(</span></span>
<span>    dataname <span class="op">=</span> <span class="st">"ADTTE"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/scda/man/synthetic_cdisc_dataset.html" class="external-link">synthetic_cdisc_dataset</a></span><span class="op">(</span>dataset_name <span class="op">=</span> <span class="st">"adtte"</span>, archive_name <span class="op">=</span> <span class="st">"latest"</span><span class="op">)</span>,</span>
<span>    code <span class="op">=</span> <span class="st">"ADTTE &lt;- synthetic_cdisc_dataset(dataset_name = \"adtte\", archive_name = \"latest\")"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>One can combine multiple delayed data objects using
<code>[teal|cdisc]_data</code> functions and include them in a shiny
application. <code>TealData</code> gathers all objects and sets combined
UI with shiny inputs from all objects. In the code chunk below we
specified four dataset connectors, but it works with arbitrary many
objects of any combination of the classes <code>TealDataset</code>,
<code>TealDatasetConnector</code> and / or
<code>TealDataConnector</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adsl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scda_dataset_connector.html">scda_cdisc_dataset_connector</a></span><span class="op">(</span><span class="st">"ADSL"</span>, <span class="st">"adsl"</span><span class="op">)</span></span>
<span><span class="va">adae</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scda_dataset_connector.html">scda_cdisc_dataset_connector</a></span><span class="op">(</span><span class="st">"ADAE"</span>, <span class="st">"adae"</span><span class="op">)</span></span>
<span><span class="va">advs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scda_dataset_connector.html">scda_cdisc_dataset_connector</a></span><span class="op">(</span><span class="st">"ADVS"</span>, <span class="st">"advs"</span><span class="op">)</span></span>
<span><span class="va">adtte</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scda_dataset_connector.html">scda_cdisc_dataset_connector</a></span><span class="op">(</span><span class="st">"ADTTE"</span>, <span class="st">"adtte"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cdisc_data.html">cdisc_data</a></span><span class="op">(</span><span class="va">adsl</span>, <span class="va">adae</span>, <span class="va">advs</span>, <span class="va">adtte</span><span class="op">)</span></span></code></pre></div>
<p><code>TealData</code> also contains a <code>launch()</code> method to
investigate if data is set correctly. However, <code>TealData</code>
lacks the <code><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull()</a></code> method.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="fu">launch</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Reproducible code attached to the <code>data</code> object is
combined code of all components, but one can also extract code from
single dataset by specifying <code>dataname</code> argument.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_code.html">get_code</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "ADSL &lt;- scda::synthetic_cdisc_dataset(dataset_name = \"adsl\", archive_name = \"latest\")\nADAE &lt;- scda::synthetic_cdisc_dataset(dataset_name = \"adae\", archive_name = \"latest\")\nADVS &lt;- scda::synthetic_cdisc_dataset(dataset_name = \"advs\", archive_name = \"latest\")\nADTTE &lt;- scda::synthetic_cdisc_dataset(dataset_name = \"adtte\", archive_name = \"latest\")"</span></span>
<span><span class="fu"><a href="../reference/get_code.html">get_code</a></span><span class="op">(</span><span class="va">data</span>, dataname <span class="op">=</span> <span class="st">"ADSL"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "ADSL &lt;- scda::synthetic_cdisc_dataset(dataset_name = \"adsl\", archive_name = \"latest\")"</span></span>
<span><span class="fu"><a href="../reference/get_code.html">get_code</a></span><span class="op">(</span><span class="va">data</span>, dataname <span class="op">=</span> <span class="st">"ADTTE"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "ADTTE &lt;- scda::synthetic_cdisc_dataset(dataset_name = \"adtte\", archive_name = \"latest\")"</span></span></code></pre></div>
<p>Developers can also extract datasets and connectors included in the
<code>TealData</code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># if you launched the shiny app and pressed the submit button above to load the data,</span></span>
<span><span class="co"># then these 4 lines do not need to be run</span></span>
<span><span class="va">adsl</span><span class="op">$</span><span class="fu">pull</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">adae</span><span class="op">$</span><span class="fu">pull</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">advs</span><span class="op">$</span><span class="fu">pull</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">adtte</span><span class="op">$</span><span class="fu">pull</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get loaded datasets</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="fu">get_datasets</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get single dataset</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="fu">get_dataset</span><span class="op">(</span>dataname <span class="op">=</span> <span class="st">"ADSL"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get data and dataset connectors</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="fu">get_connectors</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get all datasets/connectors</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="fu">get_items</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-modification">Data modification<a class="anchor" aria-label="anchor" href="#data-modification"></a>
</h3>
<p>To modify a single dataset one should use <code>mutate_dataset</code>
by specifying <code>code</code> argument with code as a single character
or <code>script</code> with location of the script file. In the case of
delayed data, the pre-processing code passed into
<code>mutate_dataset</code> would be run after the data becomes
available.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adsl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cdisc_dataset.html">cdisc_dataset</a></span><span class="op">(</span></span>
<span>  dataname <span class="op">=</span> <span class="st">"ADSL"</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/scda/man/synthetic_cdisc_dataset.html" class="external-link">synthetic_cdisc_dataset</a></span><span class="op">(</span>dataset_name <span class="op">=</span> <span class="st">"adsl"</span>, archive_name <span class="op">=</span> <span class="st">"latest"</span><span class="op">)</span>,</span>
<span>  code <span class="op">=</span> <span class="st">"ADSL &lt;- synthetic_cdisc_dataset(dataset_name = \"adsl\", archive_name = \"latest\")"</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/mutate_dataset.html">mutate_dataset</a></span><span class="op">(</span>code <span class="op">=</span> <span class="st">"ADSL$x1 &lt;- 1"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">adtte</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scda_dataset_connector.html">scda_cdisc_dataset_connector</a></span><span class="op">(</span></span>
<span>  dataname <span class="op">=</span> <span class="st">"ADTTE"</span>, <span class="st">"adtte"</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/mutate_dataset.html">mutate_dataset</a></span><span class="op">(</span>code <span class="op">=</span> <span class="st">"ADTTE$x2 &lt;- 2"</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="../reference/get_code.html">get_code()</a></code> function returns loading code from
<code>CallableFunction</code> and mutation code as provided in using
<code>mutate_dataset</code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_code.html">get_code</a></span><span class="op">(</span><span class="va">adsl</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; ADSL &lt;- synthetic_cdisc_dataset(dataset_name = "adsl", archive_name = "latest")</span></span>
<span><span class="co">#&gt; ADSL$x1 &lt;- 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_code.html">get_code</a></span><span class="op">(</span><span class="va">adtte</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; ADTTE &lt;- scda::synthetic_cdisc_dataset(dataset_name = "adtte", archive_name = "latest")</span></span>
<span><span class="co">#&gt; ADTTE$x2 &lt;- 2</span></span></code></pre></div>
<p><code>mutate_dataset</code> can also be used on <code>TealData</code>
objects which applies the <code>code</code> to the dataset specified in
<code>dataname</code>. This is important, as <code>TealData</code> can
track each call which affects this particular dataset. Check the code
below, where we create data containing two datasets using the
<code>cdisc_data</code> function. We can still use
<code>mutate_dataset</code> on the object which contains multiple
datasets, with one requirement - one needs to specify
<code>dataname</code>. Afterwards, one can extract reproducible code
from data which affects this particular <code>dataname</code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cdisc_data.html">cdisc_data</a></span><span class="op">(</span><span class="va">adsl</span>, <span class="va">adtte</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/mutate_dataset.html">mutate_dataset</a></span><span class="op">(</span>code <span class="op">=</span> <span class="st">"ADSL$x3 &lt;- 3"</span>, dataname <span class="op">=</span> <span class="st">"ADSL"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get reproducible code of all datasets</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_code.html">get_code</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; ADSL &lt;- synthetic_cdisc_dataset(dataset_name = "adsl", archive_name = "latest")</span></span>
<span><span class="co">#&gt; ADSL$x1 &lt;- 1</span></span>
<span><span class="co">#&gt; ADTTE &lt;- scda::synthetic_cdisc_dataset(dataset_name = "adtte", archive_name = "latest")</span></span>
<span><span class="co">#&gt; ADTTE$x2 &lt;- 2</span></span>
<span><span class="co">#&gt; ADSL$x3 &lt;- 3</span></span>
<span></span>
<span><span class="co"># get ADSL reproducible code</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_code.html">get_code</a></span><span class="op">(</span><span class="va">data</span>, dataname <span class="op">=</span> <span class="st">"ADSL"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; ADSL &lt;- synthetic_cdisc_dataset(dataset_name = "adsl", archive_name = "latest")</span></span>
<span><span class="co">#&gt; ADSL$x1 &lt;- 1</span></span>
<span><span class="co">#&gt; ADSL$x3 &lt;- 3</span></span></code></pre></div>
<p>One can also pipe multiple <code>mutate_dataset</code> calls applied
on different datasets.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mutate_dataset.html">mutate_dataset</a></span><span class="op">(</span><span class="va">data</span>, code <span class="op">=</span> <span class="st">"ADTTE$x4 &lt;- 4"</span>, dataname <span class="op">=</span> <span class="st">"ADTTE"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/mutate_dataset.html">mutate_dataset</a></span><span class="op">(</span>code <span class="op">=</span> <span class="st">"ADSL &lt;- dplyr::filter(ADSL, SEX == 'F')"</span>, dataname <span class="op">=</span> <span class="st">"ADSL"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_code.html">get_code</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"ADSL"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; ADSL &lt;- synthetic_cdisc_dataset(dataset_name = "adsl", archive_name = "latest")</span></span>
<span><span class="co">#&gt; ADSL$x1 &lt;- 1</span></span>
<span><span class="co">#&gt; ADSL$x3 &lt;- 3</span></span>
<span><span class="co">#&gt; ADSL &lt;- dplyr::filter(ADSL, SEX == "F")</span></span>
<span><span class="co"># note that the code for ADTTE below does not contain any mention of ADSL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_code.html">get_code</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"ADTTE"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; ADTTE &lt;- scda::synthetic_cdisc_dataset(dataset_name = "adtte", archive_name = "latest")</span></span>
<span><span class="co">#&gt; ADTTE$x2 &lt;- 2</span></span>
<span><span class="co">#&gt; ADTTE$x4 &lt;- 4</span></span></code></pre></div>
<p>Sometimes code of one object can depend on another, in this case we
can link them in the same way we link <code>TealDatasetConnector</code>
objects. If object code is dependent on another, as ADTTE depends on
ADSL below, <code>get_code</code> will return everything we need to be
executed to reproduce this dataset.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mutate_dataset.html">mutate_dataset</a></span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  code <span class="op">=</span> <span class="st">"ADTTE &lt;- filter(ADTTE, USUBJID %in% ADSL$USUBJID)"</span>,</span>
<span>  dataname <span class="op">=</span> <span class="st">"ADTTE"</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ADSL <span class="op">=</span> <span class="va">adsl</span><span class="op">)</span> <span class="co"># vars = list(&lt;DATANAME&gt; = &lt;dataset name&gt;))</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/mutate_dataset.html">mutate_dataset</a></span><span class="op">(</span><span class="st">"ADSL$var_created_after &lt;- NA"</span>, dataname <span class="op">=</span> <span class="st">"ADSL"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># note that the code that defines ADSL is now part of the code of ADTTE below</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_code.html">get_code</a></span><span class="op">(</span><span class="va">data</span>, dataname <span class="op">=</span> <span class="st">"ADTTE"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; ADSL &lt;- synthetic_cdisc_dataset(dataset_name = "adsl", archive_name = "latest")</span></span>
<span><span class="co">#&gt; ADSL$x1 &lt;- 1</span></span>
<span><span class="co">#&gt; ADTTE &lt;- scda::synthetic_cdisc_dataset(dataset_name = "adtte", archive_name = "latest")</span></span>
<span><span class="co">#&gt; ADTTE$x2 &lt;- 2</span></span>
<span><span class="co">#&gt; ADSL$x3 &lt;- 3</span></span>
<span><span class="co">#&gt; ADTTE$x4 &lt;- 4</span></span>
<span><span class="co">#&gt; ADSL &lt;- dplyr::filter(ADSL, SEX == "F")</span></span>
<span><span class="co">#&gt; ADTTE &lt;- filter(ADTTE, USUBJID %in% ADSL$USUBJID)</span></span>
<span></span>
<span><span class="co"># moreover, note that the code inserted to the mutate_dataset after the pipe was not included.</span></span></code></pre></div>
<p>Using <code>mutate_dataset</code> creates a tree of calls, which can
be subset by <code>dataname</code>, but developers can also use
<code>mutate_data</code> function which doesn’t require
<code>dataname</code> to be specified. When <code>mutate_data</code> is
used, code for a single dataset is not possible to be subset, instead
code of all datasets is returned.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mutate_data.html">mutate_data</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>  code <span class="op">=</span> <span class="st">"</span></span>
<span><span class="st">    ADSL$x3 &lt;- 3</span></span>
<span><span class="st">    proxy_var &lt;- 4</span></span>
<span><span class="st">    ADTTE$x4 &lt;- proxy_var</span></span>
<span><span class="st">  "</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># single dataset code is not possible to obtain anymore</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">adsl_code</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_code.html">get_code</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"ADSL"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; ADSL &lt;- synthetic_cdisc_dataset(dataset_name = "adsl", archive_name = "latest")</span></span>
<span><span class="co">#&gt; ADSL$x1 &lt;- 1</span></span>
<span><span class="co">#&gt; ADTTE &lt;- scda::synthetic_cdisc_dataset(dataset_name = "adtte", archive_name = "latest")</span></span>
<span><span class="co">#&gt; ADTTE$x2 &lt;- 2</span></span>
<span><span class="co">#&gt; ADSL$x3 &lt;- 3</span></span>
<span><span class="co">#&gt; ADTTE$x4 &lt;- 4</span></span>
<span><span class="co">#&gt; ADSL &lt;- dplyr::filter(ADSL, SEX == "F")</span></span>
<span><span class="co">#&gt; ADTTE &lt;- filter(ADTTE, USUBJID %in% ADSL$USUBJID)</span></span>
<span><span class="co">#&gt; ADSL$var_created_after &lt;- NA</span></span>
<span><span class="co">#&gt; ADSL$x3 &lt;- 3</span></span>
<span><span class="co">#&gt; proxy_var &lt;- 4</span></span>
<span><span class="co">#&gt; ADTTE$x4 &lt;- proxy_var</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">adtte_code</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_code.html">get_code</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"ADTTE"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; ADSL &lt;- synthetic_cdisc_dataset(dataset_name = "adsl", archive_name = "latest")</span></span>
<span><span class="co">#&gt; ADSL$x1 &lt;- 1</span></span>
<span><span class="co">#&gt; ADTTE &lt;- scda::synthetic_cdisc_dataset(dataset_name = "adtte", archive_name = "latest")</span></span>
<span><span class="co">#&gt; ADTTE$x2 &lt;- 2</span></span>
<span><span class="co">#&gt; ADSL$x3 &lt;- 3</span></span>
<span><span class="co">#&gt; ADTTE$x4 &lt;- 4</span></span>
<span><span class="co">#&gt; ADSL &lt;- dplyr::filter(ADSL, SEX == "F")</span></span>
<span><span class="co">#&gt; ADTTE &lt;- filter(ADTTE, USUBJID %in% ADSL$USUBJID)</span></span>
<span><span class="co">#&gt; ADSL$var_created_after &lt;- NA</span></span>
<span><span class="co">#&gt; ADSL$x3 &lt;- 3</span></span>
<span><span class="co">#&gt; proxy_var &lt;- 4</span></span>
<span><span class="co">#&gt; ADTTE$x4 &lt;- proxy_var</span></span>
<span></span>
<span><span class="co"># TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">adsl_code</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">adtte_code</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="teal-data-in-a-shiny-app">
<code>teal.data</code> in a shiny app<a class="anchor" aria-label="anchor" href="#teal-data-in-a-shiny-app"></a>
</h3>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adsl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scda_dataset_connector.html">scda_cdisc_dataset_connector</a></span><span class="op">(</span><span class="st">"ADSL"</span>, <span class="st">"adsl"</span><span class="op">)</span></span>
<span><span class="va">adrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scda_dataset_connector.html">scda_cdisc_dataset_connector</a></span><span class="op">(</span><span class="st">"ADRS"</span>, <span class="st">"adrs"</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dataset.html">dataset</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, code <span class="op">=</span> <span class="st">"x &lt;- data.frame(x = 1, b = 2)"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/teal_data.html">teal_data</a></span><span class="op">(</span><span class="va">adsl</span>, <span class="va">adrs</span>, <span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span></span>
<span>  ui <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>    <span class="fu">shinyjs</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shinyjs/man/useShinyjs.html" class="external-link">useShinyjs</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html" class="external-link">titlePanel</a></span><span class="op">(</span><span class="st">"Delayed data loading"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html" class="external-link">sidebarLayout</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html" class="external-link">sidebarPanel</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="fu">get_ui</span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html" class="external-link">uiOutput</a></span><span class="op">(</span><span class="st">"dataset"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html" class="external-link">mainPanel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderTable.html" class="external-link">tableOutput</a></span><span class="op">(</span><span class="st">"dist_plot"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  server <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">data_reactive</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="fu">get_server</span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent</a></span><span class="op">(</span><span class="fu">data_reactive</span><span class="op">(</span><span class="op">)</span>, ignoreNULL <span class="op">=</span> <span class="cn">TRUE</span>, <span class="op">{</span></span>
<span>      <span class="fu">shinyjs</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shinyjs/man/visibilityFuncs.html" class="external-link">hide</a></span><span class="op">(</span><span class="st">"data-delayed_data"</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html" class="external-link">renderUI</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html" class="external-link">req</a></span><span class="op">(</span><span class="fu">data_reactive</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">datanames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_raw_data.html">get_raw_data</a></span><span class="op">(</span><span class="fu">data_reactive</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/radioButtons.html" class="external-link">radioButtons</a></span><span class="op">(</span><span class="st">"dataname"</span>, <span class="st">"Select dataname"</span>, <span class="va">datanames</span>, <span class="va">datanames</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">dist_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderTable.html" class="external-link">renderTable</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html" class="external-link">req</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">dataname</span><span class="op">)</span></span>
<span>      <span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_raw_data.html">get_raw_data</a></span><span class="op">(</span><span class="fu">data_reactive</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="va">input</span><span class="op">$</span><span class="va">dataname</span><span class="op">]</span><span class="op">]</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Listening on http://127.0.0.1:5993</span></span></code></pre></div>
<p><img src="using-delayed-data-advanced_files/figure-html/unnamed-chunk-29-1.png" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="nest">
  <p>teal.data is a part of the <strong>NEST</strong> and <a href="https://pharmaverse.org/" class="external-link"><strong>pharmaverse</strong></a>.</p>
</div>
<script type="text/javascript" src="../analytics.js"></script></footer>
</div>

  

  

  </body>
</html>
